<!Doctype html>
<head>
    <title>GoT Bootstrap Demo</title>
    <link rel="stylesheet" href="css/bootstrap.min.css"/>
    <link rel="stylesheet" href="css/styles.css"/>
</head>
<body>
<div class="jumbotron text-center">
    Language Playpen
</div>
<div class="container" id="container">
    <div class="col-md-12">
        <div class="jumbotron text-center">
            Jumbotron text2
        </div>

        <div class="col-sm-5 text-justify sidepadding">
            <div id="left_column" class="col-sm-12" >
                <canvas id="canvas_left" class="col-sm-12" width="400" height="300" style="border:1px solid #000000;"></canvas>
            </div>
            <div id="left_bottom" class="col-sm-12" >
                <button type="button" class="btn btn-default col-sm-4" onclick="addGrammarSandbox(); return false;">New Grammar</button>
                <button type="button" class="btn btn-default col-sm-4" onclick="addAutomataSandbox(); return false;">New Automata</button>
                <button type="button" class="btn btn-default col-sm-4" onclick="addRegExpSandbox(); return false;">New RegExp</button>
            </div>
        </div>
        <div class="col-sm-2 text-justify sidepadding">
            <button type="button" class="btn btn-default col-sm-12" onclick="addGrammarSandbox(); return false;">New Grammar</button>
            <button type="button" class="btn btn-default col-sm-12" onclick="addAutomataSandbox(); return false;">New Automata</button>
            <button type="button" class="btn btn-default col-sm-12" onclick="addRegExpSandbox(); return false;">New RegExp</button>
        </div>
        <div class="col-sm-5 text-justify sidepadding">
            <div id="left_column" class="col-sm-12" >
                <canvas id="canvas_right" width="400" height="300" style="border:1px solid #000000;"></canvas>
            </div>
            <div id="left_bottom" class="col-sm-12" >
                <button type="button" class="btn btn-default col-sm-4" onclick="addGrammarSandbox(); return false;">New Grammar</button>
                <button type="button" class="btn btn-default col-sm-4" onclick="addAutomataSandbox(); return false;">New Automata</button>
                <button type="button" class="btn btn-default col-sm-4" onclick="addRegExpSandbox(); return false;">New RegExp</button>
            </div>
        </div>
    </div>

</div>

<script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
<script src="js/bootstrap.min.js"></script>

<script language="JavaScript">

    var sandbox_columns = [ [], [] ];

    function getSandboxContainer() {
        return document.getElementById('container')
    }

    function clearSandboxContainer() {
        getSandboxContainer().innerHTML = "";
    }

    function renderSandboxes() {
        clearSandboxContainer();
        var longest = sandbox_columns.reduce(function(a,b) { return Math.max(a.length, b.length); });
        for(var i=0; i<longest; i++) {
            var row = createRow(i);
            for(var j=0; j<sandbox_columns.length; j++) {
                if( sandbox_columns[i][j] != undefined ) {
                    // Since there's a separator between each column, the sandboxes are at indexes j*2
                    row[j*2] = createSandboxForObject(sandbox_columns[i][j])
                }
            }
            getSandboxContainer().appendChild(row);
        }
    }

    // Create a *row* of 3 divs (a sandbox, a middle, and another sandbox)
    function createRow(row_num) {
        var left = createSandboxDiv("row" + row_num + "-L");
        var mid = createMiddleDiv("row" + row_num + "-M");
        var right = createSandboxDiv("row" + row_num + "-R");
        return [ left, mid, right ];
    }

    function createSandboxDiv(id) {
        var div = document.createElement("div");
        div.setAttribute('id', id);
        div.setAttribute('class', 'col-sm-5');
        return div
    }

    function createMiddleDiv(id) {
        var div = document.createElement("div");
        div.setAttribute('id', id);
        div.setAttribute('class', 'col-sm-2');
        return div
    }



    function deleteSandbox(row,col) {

//        var element = document.getElementById(element_id);
//        element.parentNode.removeChild(element);
    }

    function getUniqueId(basename) {
        var count = 0;
        var id;
        do {
            id = basename + (count++);
        } while( document.getElementById(id) != undefined );
        return id;
    }

    function addGrammarSandbox() {
        var sandbox = createSandbox("Grammar");
//        sandbox.appendChild(createGrammarButton());
        sandbox.appendChild(createAutomataButton());
        sandbox.appendChild(createRegExpButton());
        getSandboxContainer().appendChild(sandbox);
    }

    function addAutomataSandbox() {
        var sandbox = createSandbox("Automata");
        sandbox.appendChild(createGrammarButton());
//        sandbox.appendChild(createAutomataButton());
        sandbox.appendChild(createRegExpButton());
        getSandboxContainer().appendChild(sandbox);
    }

    function addRegExpSandbox() {
        var sandbox = createSandbox("RegExp");
        sandbox.appendChild(createGrammarButton());
        sandbox.appendChild(createAutomataButton());
//        sandbox.appendChild(createRegExpButton());
        getSandboxContainer().appendChild(sandbox);
    }

    function createGrammarButton() {
        return createButton("Convert to Grammar", "generateGrammar()");
    }

    function createAutomataButton() {
        return createButton("Convert to Automata", "generateAutomata()");
    }

    function createRegExpButton() {
        return createButton("Convert to RegExp", "generateRegExp()");
    }

    function createSandbox(name) {
        var new_id = getUniqueId("sandbox");
        var div = document.createElement("div");
        div.setAttribute('id', new_id);
        div.setAttribute('class', 'col-sm-12');
        div.appendChild(document.createTextNode(name));
        div.appendChild(createCanvas(getUniqueId("canvas")));
        div.appendChild(createButton("Delete","deleteSandbox('" + new_id + "')"));
        return div;
    }

    function createButton(text, onclick) {
        var button = document.createElement("button");
        button.appendChild(document.createTextNode(text));
        button.setAttribute('class','btn btn-default col-sm-4');
        button.setAttribute('onclick',onclick + '; return false;')
        return button;
    }

    function createCanvasAt(column) {
        var num = 0;
        var ID_BASE = "grammarcanvas";
        var id_string = ID_BASE + num.toString();

        var canv = createCanvas(id_string);
        placeCanvasAt(canv, column);
    }

    function placeCanvasAt(canv, column) {
        document.getElementById('container').appendChild(canv);
    }

    function createCanvas(id) {
        var CANV_WIDTH = 400;
        var CANV_HEIGHT = 300;
        var CANV_CLASS = "col-sm-12 sandboxcanvas";
        var canv = document.createElement("canvas");
        canv.setAttribute('width',CANV_WIDTH);
        canv.setAttribute('height',CANV_HEIGHT);
        canv.setAttribute('class',CANV_CLASS);
        canv.setAttribute('id',id);
        return canv;
    }
</script>

</body>
